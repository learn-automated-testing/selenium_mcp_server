# Test Framework Standards & Conventions

This document defines the standards and conventions for test code generated by the Selenium MCP Generator Agent.

## Overview

When the Generator Agent creates test code, it **automatically follows framework-specific standards** for:
- File naming conventions
- Code structure and patterns
- Folder organization
- Import statements
- Documentation format

**Unless you specify otherwise**, these standards are applied automatically.

---

## Framework Standards

### 1. Python with pytest

#### File Naming
```
✅ CORRECT                  ❌ INCORRECT
test_login.py              login.py
test_shopping_cart.py      shopping_test.py
test_user_profile.py       UserProfileTest.py
```

**Rules**:
- Files MUST start with `test_`
- Use lowercase with underscores (snake_case)
- Extension: `.py`

#### Class Naming
```python
✅ CORRECT
class TestLogin:
class TestShoppingCart:
class TestUserProfile:

❌ INCORRECT
class LoginTest:
class Shopping_Cart_Tests:
class testUserProfile:
```

**Rules**:
- Classes MUST start with `Test`
- Use PascalCase
- Descriptive, not abbreviated

#### Method Naming
```python
✅ CORRECT
def test_valid_login(self, driver):
def test_add_item_to_cart(self, driver):
def test_empty_cart_validation(self, driver):

❌ INCORRECT
def valid_login(self, driver):
def testAddItemToCart(self, driver):
def test_1(self, driver):
```

**Rules**:
- Methods MUST start with `test_`
- Use lowercase with underscores (snake_case)
- Descriptive of what is being tested

#### Standard Structure
```python
"""Module docstring describing the test suite."""
import pytest
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC


class TestFeatureName:
    """Class docstring describing test scenarios."""

    @pytest.fixture
    def driver(self):
        """Setup and teardown browser instance."""
        driver = webdriver.Chrome()
        driver.implicitly_wait(10)
        yield driver
        driver.quit()

    def test_scenario_name(self, driver):
        """
        Test description

        Steps:
        1. Step one
        2. Step two
        """
        # Implementation
        pass
```

#### Best Practices
- ✅ Use `@pytest.fixture` for setup/teardown
- ✅ Use `assert` statements with error messages
- ✅ Use explicit waits (`WebDriverWait`)
- ✅ Group related tests in classes
- ✅ Add docstrings to classes and methods
- ❌ Avoid `time.sleep()` - use explicit waits
- ❌ Avoid `driver.implicitly_wait()` mixed with explicit waits

#### File Location
```
Default: tests/test_feature.py
Alternative: tests/e2e/test_feature.py
```

---

### 2. Python with unittest

#### File Naming
```
✅ CORRECT                  ❌ INCORRECT
test_login.py              login.py
test_shopping.py           Shopping.py
```

**Same rules as pytest** - files start with `test_`

#### Class Naming
```python
✅ CORRECT
class TestLogin(unittest.TestCase):
class TestShoppingCart(unittest.TestCase):

❌ INCORRECT
class LoginTest:  # Missing unittest.TestCase
class test_shopping(unittest.TestCase):  # Wrong case
```

**Rules**:
- MUST inherit from `unittest.TestCase`
- Class name starts with `Test` (PascalCase)

#### Method Naming
```python
✅ CORRECT
def test_valid_login(self):
def test_add_to_cart(self):

❌ INCORRECT
def testValidLogin(self):  # Wrong case
def valid_login(self):     # Missing test_ prefix
```

**Same as pytest** - methods start with `test_`

#### Standard Structure
```python
"""Module docstring."""
import unittest
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC


class TestFeatureName(unittest.TestCase):
    """Test cases for Feature Name."""

    def setUp(self):
        """Set up test fixtures."""
        self.driver = webdriver.Chrome()
        self.driver.implicitly_wait(10)

    def tearDown(self):
        """Clean up after tests."""
        self.driver.quit()

    def test_scenario_name(self):
        """Test description."""
        # Implementation
        self.assertTrue(condition, "Error message")


if __name__ == '__main__':
    unittest.main()
```

#### Best Practices
- ✅ Use `setUp()` and `tearDown()` methods
- ✅ Use `self.assert*()` methods (e.g., `self.assertTrue()`)
- ✅ Add `if __name__ == '__main__'` block
- ✅ Use `self.driver` for driver instance

---

### 3. Robot Framework

#### File Naming
```
✅ CORRECT                      ❌ INCORRECT
test_login.robot                login.txt
shopping_tests.robot            ShoppingTests.robot
test_user_registration.robot    user-registration.robot
```

**Rules**:
- Files should start with `test_` OR end with `_tests`
- Use lowercase with underscores
- Extension: `.robot`

#### Test Case Naming
```robot
✅ CORRECT
Valid User Login
Add Item To Shopping Cart
Empty Cart Validation

❌ INCORRECT
test_valid_user_login
addItemToShoppingCart
Test 1
```

**Rules**:
- Use natural language with spaces
- Title Case or Sentence case
- Descriptive, not abbreviated
- NO `test_` prefix (unlike Python)

#### Standard Structure
```robot
*** Settings ***
Documentation    Test suite description
Library          SeleniumLibrary
Suite Setup      Open Browser    ${URL}    ${BROWSER}
Suite Teardown   Close Browser
Test Setup       Go To    ${URL}

*** Variables ***
${URL}              https://example.com
${BROWSER}          chrome
${USERNAME_FIELD}   id=username
${PASSWORD_FIELD}   id=password
${LOGIN_BUTTON}     css=button[type='submit']

*** Test Cases ***
Valid User Login
    [Documentation]    Test successful login with valid credentials
    [Tags]    login    smoke

    Wait Until Element Is Visible    ${USERNAME_FIELD}    timeout=10s
    Input Text    ${USERNAME_FIELD}    testuser
    Input Text    ${PASSWORD_FIELD}    password123
    Click Button    ${LOGIN_BUTTON}

    Wait Until Element Is Visible    css=.welcome-message    timeout=10s
    Element Text Should Be    css=.welcome-message    Welcome, testuser

*** Keywords ***
Login With Credentials
    [Arguments]    ${username}    ${password}
    [Documentation]    Reusable keyword for login

    Input Text    ${USERNAME_FIELD}    ${username}
    Input Text    ${PASSWORD_FIELD}    ${password}
    Click Button    ${LOGIN_BUTTON}
```

#### Best Practices
- ✅ Use `*** Settings ***`, `*** Variables ***`, `*** Test Cases ***`, `*** Keywords ***` sections
- ✅ Add `[Documentation]` to test cases
- ✅ Add `[Tags]` for categorization
- ✅ Use variables for selectors (`${VARIABLE_NAME}`)
- ✅ Use `Wait Until Element Is Visible` before interactions
- ✅ Use 4 spaces for indentation
- ✅ Create reusable keywords for common actions
- ❌ Avoid hard-coded values - use variables

#### File Location
```
Default: tests/test_feature.robot
Alternative: tests/e2e/feature_tests.robot
```

---

### 4. WebDriverIO with JavaScript

#### File Naming
```
✅ CORRECT                  ❌ INCORRECT
login.test.js              login.js
shopping.spec.js           shopping_test.js
userProfile.test.js        UserProfile.js
```

**Rules**:
- Files MUST end with `.test.js` or `.spec.js`
- Use camelCase or kebab-case
- Extension: `.test.js` or `.spec.js`

#### Standard Structure
```javascript
describe('Login Feature', () => {
    before(async () => {
        // Setup before all tests
    });

    after(async () => {
        // Cleanup after all tests
    });

    beforeEach(async () => {
        // Setup before each test
        await browser.url('https://example.com/login');
    });

    afterEach(async () => {
        // Cleanup after each test
    });

    it('should login successfully with valid credentials', async () => {
        // Arrange
        const username = await $('#username');
        const password = await $('#password');
        const loginBtn = await $('button[type="submit"]');

        // Act
        await username.setValue('testuser');
        await password.setValue('password123');
        await loginBtn.click();

        // Assert
        const welcomeMsg = await $('.welcome-message');
        await expect(welcomeMsg).toHaveText('Welcome, testuser');
    });

    it('should show error with invalid credentials', async () => {
        // Test implementation
    });
});
```

#### Best Practices
- ✅ Use `describe()` for test suites
- ✅ Use `it()` for individual tests
- ✅ Use `before()`, `after()`, `beforeEach()`, `afterEach()` hooks
- ✅ Use `async/await` for all WebDriverIO commands
- ✅ Use `expect()` for assertions
- ✅ Follow Arrange-Act-Assert pattern

#### File Location
```
Default: tests/login.test.js
Alternative: tests/e2e/login.spec.js
```

---

### 5. WebDriverIO with TypeScript

#### File Naming
```
✅ CORRECT                  ❌ INCORRECT
login.test.ts              login.ts
shopping.spec.ts           shopping.test.js (should be .ts)
```

**Same as JavaScript** but with `.ts` extension

#### Standard Structure
```typescript
import { expect } from '@wdio/globals';

describe('Login Feature', (): void => {
    beforeEach(async (): Promise<void> => {
        await browser.url('https://example.com/login');
    });

    it('should login successfully with valid credentials', async (): Promise<void> => {
        // Arrange
        const username: WebdriverIO.Element = await $('#username');
        const password: WebdriverIO.Element = await $('#password');
        const loginBtn: WebdriverIO.Element = await $('button[type="submit"]');

        // Act
        await username.setValue('testuser');
        await password.setValue('password123');
        await loginBtn.click();

        // Assert
        const welcomeMsg: WebdriverIO.Element = await $('.welcome-message');
        await expect(welcomeMsg).toHaveText('Welcome, testuser');
    });
});
```

#### Best Practices
- ✅ All JavaScript best practices apply
- ✅ Add type annotations to variables
- ✅ Add return types to functions (`: void`, `: Promise<void>`)
- ✅ Import types from `@wdio/globals`
- ✅ Use `WebdriverIO.Element` type for elements

---

## Folder Structure

### Default Structure (Simple Projects)
```
project/
├── tests/
│   ├── test_login.py           # pytest/unittest
│   ├── test_shopping.py
│   ├── test_checkout.robot     # Robot Framework
│   └── login.test.js           # WebDriverIO
│
├── test-plans/
│   ├── login_plan.md
│   └── shopping_plan.md
│
└── [framework config files]
```

### Advanced Structure (Large Projects)
```
project/
├── tests/
│   ├── unit/                   # Unit tests
│   ├── integration/            # Integration tests
│   ├── e2e/                    # E2E tests (Selenium tests go here)
│   │   ├── test_login.py
│   │   ├── test_shopping.py
│   │   └── test_checkout.robot
│   ├── pages/                  # Page Object Model classes
│   │   ├── login_page.py
│   │   ├── shopping_page.py
│   │   └── base_page.py
│   └── fixtures/               # Test data
│       ├── test_data.json
│       └── users.csv
│
├── test-plans/
│   └── [test plan documents]
│
├── results/                    # Test results (auto-generated)
│   ├── report.html
│   └── screenshots/
│
└── [config files]
```

### Directory Detection Logic

The Generator Agent will **automatically detect and use** existing test directories:

**Priority order**:
1. `tests/e2e/` (if exists) ← Preferred for E2E tests
2. `tests/` (if exists) ← Default
3. `test/` (if exists) ← Alternative
4. `e2e/` (if exists) ← Alternative
5. Create `tests/` (if none exist) ← Fallback

---

## Code Quality Standards

All generated test code MUST include:

### 1. Proper Imports
```python
# ✅ CORRECT - All imports at the top, organized
import pytest
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

# ❌ INCORRECT - Missing imports
from selenium import webdriver
# Missing By, WebDriverWait, etc.
```

### 2. Documentation
```python
# ✅ CORRECT
class TestLogin:
    """Test cases for login functionality."""

    def test_valid_login(self, driver):
        """
        Test successful login with valid credentials.

        Steps:
        1. Navigate to login page
        2. Enter valid username and password
        3. Click login button
        4. Verify successful login
        """
        pass

# ❌ INCORRECT - No docstrings
class TestLogin:
    def test_valid_login(self, driver):
        pass
```

### 3. Explicit Waits (NOT Sleep)
```python
# ✅ CORRECT
element = WebDriverWait(driver, 10).until(
    EC.element_to_be_clickable((By.ID, "login-btn"))
)
element.click()

# ❌ INCORRECT
import time
time.sleep(5)
driver.find_element(By.ID, "login-btn").click()
```

### 4. Descriptive Variable Names
```python
# ✅ CORRECT
username_field = driver.find_element(By.ID, "username")
login_button = driver.find_element(By.CSS_SELECTOR, "button[type='submit']")

# ❌ INCORRECT
u = driver.find_element(By.ID, "username")
btn = driver.find_element(By.CSS_SELECTOR, "button[type='submit']")
```

### 5. Error Messages in Assertions
```python
# ✅ CORRECT
assert cart_count.text == "1", "Cart count should be 1 after adding item"
assert welcome_msg.is_displayed(), "Welcome message should be visible after login"

# ❌ INCORRECT
assert cart_count.text == "1"
assert welcome_msg.is_displayed()
```

### 6. Proper Indentation
- **Python**: 4 spaces
- **Robot Framework**: 4 spaces
- **JavaScript/TypeScript**: 2 spaces

---

## User Overrides

### Custom File Paths

If you specify a custom path, the agent will use it:

```
You: "Save the tests to automation/selenium/custom_tests.py"

Agent: ✅ Saved to: automation/selenium/custom_tests.py (as requested)
       Note: Still following pytest code conventions
```

### Custom Naming

If you specify a custom filename:

```
You: "Save as my_login_tests.py"

Agent: ⚠️ Warning: pytest tests should start with 'test_'
       ✅ Auto-corrected to: test_my_login_tests.py
       (Use custom path if you want to override)
```

To force custom naming without auto-correction:
```
You: "Save to tests/custom/my_login_tests.py"

Agent: ✅ Saved to: tests/custom/my_login_tests.py (as requested)
```

---

## Framework Configuration Files

The agent may suggest creating configuration files:

### pytest.ini (pytest)
```ini
[pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts = -v --tb=short
```

### conftest.py (pytest)
```python
import pytest
from selenium import webdriver

@pytest.fixture(scope="session")
def driver():
    driver = webdriver.Chrome()
    yield driver
    driver.quit()
```

### robot.yaml (Robot Framework)
```yaml
test:
  - tests/**/*.robot

include:
  - smoke
  - regression

outputdir: results
```

### wdio.conf.js (WebDriverIO)
```javascript
exports.config = {
    specs: [
        './tests/**/*.test.js'
    ],
    framework: 'mocha',
    reporters: ['spec'],
    // ... other config
};
```

---

## Summary

The Generator Agent **automatically**:
✅ Applies framework naming conventions
✅ Uses correct file extensions
✅ Saves to appropriate directories
✅ Follows code quality standards
✅ Includes proper documentation
✅ Uses explicit waits
✅ Adds error messages to assertions
✅ Provides run commands

**Unless you specify otherwise**, all standards are applied by default.

---

## Quick Reference Table

| Framework | File Naming | Extension | Location | Class Naming |
|-----------|-------------|-----------|----------|--------------|
| pytest | `test_*.py` | `.py` | `tests/` | `Test*` |
| unittest | `test_*.py` | `.py` | `tests/` | `Test*(unittest.TestCase)` |
| Robot Framework | `test_*.robot` or `*_tests.robot` | `.robot` | `tests/` | N/A |
| WebDriverIO JS | `*.test.js` or `*.spec.js` | `.test.js` | `tests/` | N/A |
| WebDriverIO TS | `*.test.ts` or `*.spec.ts` | `.test.ts` | `tests/` | N/A |

---

For more information, see:
- [AGENT_WORKFLOW.md](AGENT_WORKFLOW.md) - Complete workflow guide
- [README.md](README.md) - Main documentation
- Framework official documentation for advanced patterns
